{"ast":null,"code":"import { getPrismicClient } from '../../services/prismic';\n\nfunction linkResolver(doc) {\n  if (doc.type === 'posts') {\n    return `/post/${doc.uid}`;\n  }\n\n  return '/';\n}\n\nexport default (async (req, res) => {\n  const {\n    token: ref,\n    documentId\n  } = req.query;\n  const redirectUrl = await getPrismicClient(req).getPreviewResolver(String(ref), String(documentId)).resolve(linkResolver, '/');\n\n  if (!redirectUrl) {\n    return res.status(401).json({\n      message: 'Invalid token'\n    });\n  }\n\n  res.setPreviewData({\n    ref\n  });\n  res.write(`<!DOCTYPE html><html><head><meta http-equiv=\"Refresh\" content=\"0; url=${redirectUrl}\" />\n    <script>window.location.href = '${redirectUrl}'</script>\n    </head>`);\n  res.end();\n});","map":null,"metadata":{},"sourceType":"module"}